# SengenUI 依存性検証レポート

**検証日時**: 2025年12月27日  
**検証対象**: `app-ts/src/Packages/SengenUI/`（169ファイル）  
**検証方法**: PowerShell grep パターンマッチング

---

## 🔍 検証結果

### 外部依存: **検出あり** ⚠️

**依存パターン**:
- `../../../Math/` への参照
- `../../../MathMLLv2Components/` への参照
- `../../../ObjectGraph/` への参照（新規発見）

---

## 📊 詳細な依存リスト

### 1. MathMLLv2Components への依存（2ファイル）

| ファイル | 参照先 | 用途 |
|---------|--------|------|
| `HtmlComponentBase.ts` | `ILV2MathMLComponent` | MathML v2 インターフェース |
| `MathMLComponents/BaseClasses/MathMLContainerBase.ts` | `ILV2MathMLComponent` | コンテナ基底クラス |

**影響**: MathML コンポーネントの型定義

### 2. Math への依存（2ファイル）

| ファイル | 参照先 | 用途 |
|---------|--------|------|
| `css長さ単位.ts` | `../../../Math/LinearAlgebra/数と全単射な物` | 数学型の継承 |
| `MathMLComponents/BaseClasses/MathMLContainerBase.ts` | 間接参照 | マスは未確認 |

**影響**: CSS 単位の数値基底、グラフデータ構造

### 3. ObjectGraph への依存（新規発見）

| ファイル | 参照先 |
|---------|--------|
| `css長さ単位.ts` | `../../../ObjectGraph/基本オブジェクト/位置関係` |

**影響**: ベクトル型と座標操作

---

## 🎯 パッケージ化への影響

### 現在の状況

SengenUI は **完全には独立していない** が、依存は以下に限定されている：

```
SengenUI
  ├─→ Math/LinearAlgebra/     （数学基礎）
  ├─→ ObjectGraph/           （グラフデータ）
  └─→ MathMLLv2Components/   （型定義）
```

### 解決策

#### 案 A: 依存をパッケージ化 【推奨】

SengenUI の package.json で **peerDependencies** として明記：

```json
{
  "name": "@voiro/ui-component",
  "peerDependencies": {
    "@voiro/math": "workspace:*",
    "@voiro/object-graph": "workspace:*"
  }
}
```

**メリット**:
- SengenUI 自体はシンプル
- 依存関係が明確
- 他のプロジェクトでも math/ObjectGraph を共有可能

**実装**:
- `packages/math/` に `Math/LinearAlgebra` を統合
- `packages/object-graph/` に `ObjectGraph` を統合
- `tsconfig.json` で paths を設定

#### 案 B: 依存を内部化 【代替案】

必要な機能を SengenUI に統合：

```
Packages/
  SengenUI/
    SengenBase/
      types/              ← 数学型をコピー
      utils/              ← ObjectGraph をコピー
```

**メリット**:
- 外部依存なし
- パッケージングが簡単

**デメリット**:
- コード重複
- 他のパッケージから利用不可

#### 案 C: 依存を削除 【最小化】

ILV2MathMLComponent と数学型の使用を減らす：

```typescript
// Before
import { ILV2MathMLComponent } from '../../../MathMLLv2Components';
export class MathMLContainerBase extends MathMLElementBase implements ILV2MathMLComponent

// After
export class MathMLContainerBase extends MathMLElementBase
// インターフェース定義は SengenUI 内に
```

**メリット**: 完全な独立

**デメリット**: インターフェース管理が複雑化

---

## 📋 推奨アクション

### Phase 1: 詳細調査（本日中）

以下を確認：
- [ ] Math/LinearAlgebra の他の依存
- [ ] ObjectGraph の他の依存
- [ ] MathMLLv2Components の役割確認

### Phase 2: 戦略決定（明日）

- [ ] 案 A, B, C から選択
- [ ] 実装タイムラインを決定

### Phase 3: 実装

選択した案に従い実装

---

## ✅ チェックリスト

- [x] 外部依存を特定
- [x] ファイル位置を特定
- [ ] 各依存の必須度を評価
- [ ] 代替案の実装難度を評価
- [ ] パッケージ化戦略を決定

---

**次のステップ**: ユーザーに結果報告 → 戦略決定 → 実装
